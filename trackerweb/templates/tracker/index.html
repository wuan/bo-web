<!doctype html>
<title>Hello from Flask</title>
{% include 'includes/base.html' %}
  <h1>Hello World!</h1>

<h2>current information</h2>

uptime: {{ info.uptime }}

<h3>recent activity</h3>

<table>
<tr>
<th># of events</th><th>average events per second</th>
</tr>
<tr>
<td>{{info.numberofevents}}</td><td>{{info.eventspersecond}}</td>
</tr>
</table>

<h2>activity</h2>

<h3>last hour</h3>

<div id="activity_plot"></div>

<script type="text/javascript">
$.getJSON($SCRIPT_ROOT + '/backend/tracker/activity', function(data) {

var totalWidth = 400;
var totalHeight = 200;
var padding = 6;
var width = totalWidth - padding;
var height = totalHeight;
var barWidth = width / data.length;

var x = d3.scale.linear().domain([0, data.length]).range([0, width - 1]);
var y = d3.scale.linear().domain([0, d3.max(data)]).range([1, height]);

var barDemo = d3.select("#activity_plot").
  append("svg:svg").
  attr("width", totalWidth).
  attr("height", totalHeight);

/*barDemo.
  append("svg:rect").
  attr("x", 0).
  attr("y", 0).
  attr("height", totalHeight).
  attr("width", totalWidth).
  attr("stroke", "green").
  attr("fill", "#aaaaaa");*/

var dataGroup = barDemo.append("svg:g").
  attr("transform", "translate("+padding+",0)");

  dataGroup.selectAll("rect").
  data(data).
  enter().
  append("svg:rect").
  attr("x", function(datum, index) { return x(index); }).
  attr("y", function(datum, index) { return height - y(datum); }).
  attr("height", function(datum, index) { return y(datum); }).
  attr("width", barWidth).
  attr("fill", "#6688cc");

dataGroup.selectAll("text").
  data(data).
  enter().
  append("svg:text").
  attr("x", function(datum, index) { return (x(index) + barWidth/2.0); }).
  attr("y", function(datum) { return height - y(datum); }).
  attr("dy", "1.2em").
  attr("text-anchor", "middle").
  text(function(datum) {return datum;}).
  style("fill", "white").
  style("font-size", 4);

var axisGroup = barDemo.append("svg:g").
  attr("transform", "translate("+padding+",0)");

axisGroup.selectAll(".yTicks").
  data(d3.range(0, d3.max(data)+1)).
  enter().
  append("svg:line").
  attr("x1", -5).
  attr("y1", function(d) {return height - y(d);}).
  attr("x2", 0).
  attr("y2", function(d) {return height - y(d);}).
  style("stroke", "black").
  style("stroke-width", .5).
  attr("class", "ytics");

axisGroup.
  append("svg:line").
  attr("x1", 0).
  attr("y1", height - y(0)).
  attr("x2", x(data.length)).
  attr("y2", height - y(0)).
  style("stroke", "black").
  style("stroke-width", 0.5);

axisGroup.
  append("svg:line").
  attr("x1", 0).
  attr("y1", 0).
  attr("x2", 0).
  attr("y2", height - y(0)).
  style("stroke", "black").
  style("stroke-width", 0.5);

});
</script>

<h3>last recorded waveform</h3>

<table>
<tr>
<th>time-plot</th>
<th>xy-plot</th>
</tr>
<tr>
<td><div id="waveform_plot"></div></td>
<td><div id="xy_plot"/></td>
</tr>
</table>

<script type="text/javascript">
$.getJSON($SCRIPT_ROOT + '/backend/tracker/raw/-1', function(data) {
var eventInfo = data[0];
var data = eventInfo[9];

var timedata = data[0];
var xdata = data[1];
var ydata = data[2];

var totalWidth = 400;
var totalHeight = 200;
var padding = 6;
var width = totalWidth - padding;
var height = totalHeight;

var x = d3.scale.linear().domain([0, d3.max(timedata)]).range([0, width - 1]);
var y = d3.scale.linear().domain([-1, 1]).range([1, height]);

var waveformPlot = d3.select("#waveform_plot").
  append("svg:svg").
  attr("width", totalWidth).
  attr("height", totalHeight);

var dataGroup = waveformPlot.append("svg:g").
  attr("transform", "translate("+padding+",0)");

var txLine = d3.svg.line().
    x(function(d) { return x(d); }).
    y(function(d,i) { return height - y(xdata[i]); }).
    interpolate("linear");

var tyLine = d3.svg.line().
    x(function(d) { return x(d); }).
    y(function(d,i) { return height - y(ydata[i]); }).
    interpolate("linear");

  dataGroup.append("svg:path").
    attr("d", txLine(timedata)).
    style("stroke", "green").
    style("fill", "none");

  dataGroup.append("svg:path").
    attr("d", tyLine(timedata)).
    style("stroke", "red").
    style("fill", "none");

var timeAxisGroup = waveformPlot.append("svg:g").
  attr("transform", "translate("+padding+",0)");

timeAxisGroup.selectAll(".yTicks").
  data(d3.range(-1, 2)).
  enter().
  append("svg:line").
  attr("x1", -5).
  attr("y1", function(d) {return height - y(d);}).
  attr("x2", 0).
  attr("y2", function(d) {return height - y(d);}).
  style("stroke", "black").
  style("stroke-width", .5).
  attr("class", "ytics");

timeAxisGroup.
  append("svg:line").
  attr("x1", x(0)).
  attr("y1", height - y(0)).
  attr("x2", x(d3.max(timedata))).
  attr("y2", height - y(0)).
  style("stroke", "black").
  style("stroke-width", 0.5);

timeAxisGroup.
  append("svg:line").
  attr("x1", x(0)).
  attr("y1", height - y(1)).
  attr("x2", x(0)).
  attr("y2", height - y(-1)).
  style("stroke", "black").
  style("stroke-width", 0.5);

width = totalHeight;
height = totalHeight;

x = d3.scale.linear().domain([-1, 1]).range([0, width - 1]);
y = d3.scale.linear().domain([-1, 1]).range([1, height]);

var xyPlot = d3.select("#xy_plot").
  append("svg:svg").
  attr("width", width).
  attr("height", height);

var xyDataGroup = xyPlot.append("svg:g").
  attr("transform", "translate("+padding+",0)");

var xyLine = d3.svg.line().
    x(function(d) { return x(d); }).
    y(function(d,i) { return height - y(ydata[i]); }).
    interpolate("linear");

  xyDataGroup.append("svg:path").
    attr("d", xyLine(xdata)).
    style("stroke", "green").
    style("fill", "none");

var xyAxisGroup = xyPlot.append("svg:g").
  attr("transform", "translate("+padding+",0)");

xyAxisGroup.
  append("svg:line").
  attr("x1", x(-1)).
  attr("y1", height - y(0)).
  attr("x2", x(1)).
  attr("y2", height - y(0)).
  style("stroke", "black").
  style("stroke-width", 0.5);

xyAxisGroup.
  append("svg:line").
  attr("x1", x(0)).
  attr("y1", height - y(1)).
  attr("x2", x(0)).
  attr("y2", height - y(-1)).
  style("stroke", "black").
  style("stroke-width", 0.5);

});
</script>
